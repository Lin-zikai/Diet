项目说明：饮食对慢性呼吸系统疾病的影响

本仓库包含用于清洗和提取 UK Biobank 原始表格（CSV）中呼吸系统相关疾病信息的 R 脚本 `1.wash_data.R`。

以下为本次数据清洗脚本的要点（中文说明）：

## 输入数据要求

- 输入文件路径在脚本中指定为：`/data/shared/UKB/all_all.csv`（可在脚本中修改为本地路径）。
- 脚本会检查并尝试读取以下潜在列（若存在则使用）：
	- `eid` 或类似的样本 ID 列（脚本会尝试匹配 `^eid$` 或 `^f.eid$`）。
	- `p41270`：含 ICD 编码的列（字符串，形如 "['J440','J441']" 等，脚本会去除中括号和单引号并按逗号分割）。
	- `p31`：性别（Sex）。
	- `p21001_i0`：BMI。
	- `p21022`：年龄（Age）。
	- `p20116_i0`：吸烟状态（smoke）。
	- `p21000_i0`：种族（Ethnic）（脚本未在最终输出中使用，但会尝试读取）。
	- 另外脚本会自动检索并读取名称匹配模式 `p41280_a*` 的列（例如 `p41280_a1, p41280_a2, ...`），这些列用于保存对应 ICD 记录的日期信息。


## 脚本处理逻辑摘要

- 从 `p41270` 中拆分出所有 ICD 代码（去除中括号和单引号后按逗号分割）。
- 定义了一组关注的 ICD 代码（主要为呼吸系统相关）：
	- COPD 相关：`J440, J441, J448, J449`
	- 哮喘：`J450, J458, J459`
	- 支气管扩张：`J47`
	- 慢性支气管炎：`J40, J410, J411, J42`
	- 肺气肿：`J430, J431, J432, J438, J439`
	- 肺纤维化（IPF）：`J841`
- 根据每个 ICD 代码在拆分后的字符串中的位置，脚本会从对应的 `p41280_aX` 列中读取该位置的事件日期，并将其转为 Date 类型，写回到原数据表为每个代码生成一个新列（列名即 ICD 代码，例如 `J440`）。
- 从所有生成的疾病代码列中，脚本会进一步聚合计算以下疾病最早发生日期（取非 NA 的最小日期）：
	- `asthma`：由 `J450/J458/J459` 取最早日期
	- `COPD`：由 `J440/J441/J448/J449` 取最早日期
	- `bronchitis`：由 `J40/J410/J411/J42` 取最早日期
	- `emphysema`：由 `J430/J431/J432/J438/J439` 取最早日期

## final 数据框（脚本最终输出）

脚本将生成一个名为 `final` 的数据框（data.frame），包含以下列：

- `eid`：个体 ID。
- `Sex`：性别（来自原列 `p31`，已重命名）。
- `BMI`：体质指数（来自原列 `p21001_i0`，已重命名）。
- `Age`：年龄（来自原列 `p21022`，已重命名）。
- `smoke`：吸烟状态（来自原列 `p20116_i0`，已重命名）。
- `telomere`：端粒相关测量（来自原列 `p22191_i0`，已重命名）。
- `start_data`：基线或起始日期字段（来自原列 `p53_i0`，已重命名）。
- `asthma`：哮喘的最早诊断日期（来自 `J450/J458/J459`，若均为 NA 则为 NA）。
- `COPD`：慢性阻塞性肺疾病的最早诊断日期（来自 `J440/J441/J448/J449`）。
- `bronchitis`：慢性/急性支气管炎的最早诊断日期（来自 `J40/J410/J411/J42`）。
- `emphysema`：肺气肿的最早诊断日期（来自 `J430/J431/J432/J438/J439`）。
- `Bronchiectasis`：支气管扩张的日期（来自 `J47`，脚本重命名为 `Bronchiectasis`）。
- `IPF`：特发性肺纤维化的日期（来自 `J841`，脚本重命名为 `IPF`）。

所有疾病日期字段均为 R 的 Date 类型或 NA。


## 最终保存文件

最终将保存一个COPD.csv文件，包含以下列

- `eid`：个体 ID。
- `COPD`：慢性阻塞性肺疾病的最早诊断日期（来自 `J440/J441/J448/J449`）。

所有疾病日期字段均为 R 的 Date 类型或 NA。
